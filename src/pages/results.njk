---js
{
  layout: "layouts/base.njk",
  permalink: "/results/index.html",
  pagination: {
    data: "results",
    size: Infinity,
    alias: "result",
    reverse: true,
    before: function (data) {

      const groupBy = (input, key) => {
        return Object.entries(
          input.reduce((acc, currentValue) => {
            let groupKey = currentValue[key];
            if (!acc[groupKey]) {
              acc[groupKey] = [];
            }
            acc[groupKey].push(currentValue);
            return acc;
          }, {})
        ).map(([year, content]) => ({ year, content }));
      };

      const obj = groupBy(data, "year");

      return obj;

    }
  },
  eleventyComputed: {
    title: "Past Results"
  }
}
---

<h1 style="margin-bottom:1rem;">
  Results from 2015 - {{ result[0].year }}
</h1>

{% for year, set in results | groupby('event_date') | dictsort | reverse %}
  <details style="margin-bottom:2rem;"{{ ' open' if loop.first }}>
    <summary>
      <h2 style="display:inline-block;margin-bottom:0.25rem;">
        {% set firstResult = set[0] %}
        {% renderTemplate "liquid", firstResult %}
          {{ event_date | date: "%Y â€¢ %A, %B %d" }}
        {% endrenderTemplate %}
      </h2>
    </summary>
    <table style="font-family:monospace;" cellpadding=2>
      <thead>
        <th scope="col">Pos</th>
        <th scope="col" style="width:100%">Name</th>
        <th scope="col">Time</th>
      </thead>
      <tbody>
        {% for result in set | sort(attribute="position") %}
          <tr>
            <td>
              {{ result.position }}
            </td>
            <td style="width:100%">
              {{ result.name }}
            </td>
            <td>
              {{ result.time }}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </details>
{% endfor %}
